---
import { siteConfig } from "../../config";
---

<!-- Experience folder content -->
<div id="experience-content" class="terminal-content hidden">
  <div class="terminal-line">
    <span class="prompt">portfolio@ryandielhenn:~/experience$</span>
    <span class="command" id="experience-command"></span>
  </div>
  
  <div class="file-content" id="experience-content-body" style="opacity: 0; transform: translateY(20px); transition: opacity 0.5s ease, transform 0.5s ease;">
    <div class="simple-content">
      <div style="margin-bottom: 1rem;">
        <h3 style="margin: 0;">Experience</h3>
      </div>
      <p>My professional journey in software engineering and distributed systems.</p>
      
      <div class="experience-list">
        {siteConfig.experience.map((job, index) => (
          <div class="experience-item">
            <div class="experience-header">
              <div class="experience-title-row">
                <h4>{job.title}</h4>
                {job.link && (
                  <a href={job.link} target="_blank" rel="noopener noreferrer" class="experience-link-inline">
                    â†— View Pull Requests to Kafka
                  </a>
                )}
              </div>
              <span class="experience-date">{job.dateRange}</span>
            </div>
            <h5 class="experience-company">{job.company}</h5>
            <ul class="experience-bullets">
              {job.bullets.map((bullet, bulletIndex) => (
                <li>{bullet}</li>
              ))}
            </ul>
          </div>
        ))}
      </div>
    </div>
  </div>
</div>

<script>
  // Typing animation for experience command
  function typeExperienceCommand(element: HTMLElement, text: string, speed: number = 80) {
    // Prevent multiple animations
    if (element.classList.contains('typing') || element.classList.contains('typing-complete')) {
      return;
    }
    
    element.textContent = '';
    element.classList.add('typing');
    
    let i = 0;
    function type() {
      if (i < text.length) {
        element.textContent += text.charAt(i);
        i++;
        setTimeout(type, speed);
      } else {
        element.classList.remove('typing');
        element.classList.add('typing-complete');
        
        // Show content after command finishes typing
        setTimeout(() => {
          const contentBody = document.getElementById('experience-content-body');
          if (contentBody) {
            contentBody.style.opacity = '1';
            contentBody.style.transform = 'translateY(0)';
          }
        }, 300);
      }
    }
    
    type();
  }

  // Flag to prevent multiple initializations
  let experienceAnimationInitialized = false;

  // Initialize typing animation when experience content becomes visible
  function initExperienceAnimation() {
    if (experienceAnimationInitialized) {
      return;
    }
    
    const experienceCommand = document.getElementById('experience-command');
    if (experienceCommand) {
      experienceAnimationInitialized = true;
      setTimeout(() => {
        typeExperienceCommand(experienceCommand, 'cat work-history.txt', 80);
      }, 500);
    }
  }

  // Listen for when experience content becomes visible
  const observer = new MutationObserver((mutations) => {
    mutations.forEach((mutation) => {
      if (mutation.type === 'attributes' && mutation.attributeName === 'class') {
        const target = mutation.target as HTMLElement;
        if (target.id === 'experience-content' && !target.classList.contains('hidden')) {
          initExperienceAnimation();
        }
      }
    });
  });

  document.addEventListener('DOMContentLoaded', () => {
    const experienceContent = document.getElementById('experience-content');
    if (experienceContent) {
      observer.observe(experienceContent, { attributes: true });
      
      // If already visible, start animation
      if (!experienceContent.classList.contains('hidden')) {
        initExperienceAnimation();
      }
    }
  });
</script>

<style>
  @import "../../styles/terminal.css";
</style>
